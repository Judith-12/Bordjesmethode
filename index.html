<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <title>Bordjesmethode — Vlekkensom</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; max-width: 800px; margin: auto; }
    h1 { text-align: center; }
    .controls { text-align: center; margin: 1rem 0; }
    select, input { padding: 0.4rem; font-size: 1rem; margin: 0.3rem; }
    button { padding: 0.5rem 0.9rem; font-size: 1rem; margin: 0.3rem; cursor: pointer; }
    #equation { font-size: 1.6rem; text-align: center; margin: 1.2rem 0; }
    #stappen { margin-top: 1.5rem; text-align: left; max-width: 720px; margin-left: auto; margin-right: auto; }
    .stapregel { background: #f8f8f8; padding: 0.6rem; border-radius: 6px; margin-bottom: 0.5rem; white-space: pre-line; }
    #feedback { font-weight: bold; text-align: center; margin-top: 1rem; }
    .muted { color: #666; font-size: 0.9rem; }
  </style>
</head>
<body>
  <h1>Bordjesmethode — Vlekkensom</h1>
  <p class="muted">Voer elke bewerking op beide kanten uit. In de stappen zie je direct het resultaat (bijv. 10 - 2 = 8).</p>

  <div class="controls">
    <label>Kies niveau:
      <select id="level" onchange="newEquation()">
        <option value="easy">Makkelijk</option>
        <option value="medium">Gemiddeld</option>
        <option value="hard">Moeilijk</option>
      </select>
    </label>
  </div>

  <div id="equation"></div>

  <div class="controls">
    <select id="bewerking">
      <option value="+">+</option>
      <option value="-">-</option>
      <option value="*">×</option>
      <option value="/">÷</option>
    </select>
    <input type="number" id="userNumber" placeholder="getal">
    <button onclick="doStep()">Voer stap uit</button>
    <button onclick="reset()">Nieuwe som</button>
  </div>

  <div id="feedback"></div>

  <h2>Stappen</h2>
  <div id="stappen"></div>

<script>
/* Eenvoudige rationale getallen (breuken) met normalisatie */
function gcd(a,b){ a = Math.abs(a); b = Math.abs(b); while(b){ let t = a % b; a = b; b = t; } return a; }
function makeR(n,d=1){ if(d===0) throw 'Deling door nul'; if(d<0){ n=-n; d=-d; } const g = gcd(n,d); return {n: n/g, d: d/g}; }
function addR(a,b){ return makeR(a.n*b.d + b.n*a.d, a.d*b.d); }
function subR(a,b){ return makeR(a.n*b.d - b.n*a.d, a.d*b.d); }
function mulR(a,b){ return makeR(a.n*b.n, a.d*b.d); }
function divR(a,b){ if(b.n===0) throw 'Deling door nul'; return makeR(a.n*b.d, a.d*b.n); }
function eqR(a,b){ return a.n===b.n && a.d===b.d; }
function isZeroR(a){ return a.n===0; }
function isOneR(a){ return a.n===a.d; }

function toStrR(a){
  if(a.d===1) return String(a.n);
  return a.n + "/" + a.d;
}

function formatLeft(coeff,consta){
  // coeff * x + const
  if(isZeroR(coeff)){
    return toStrR(consta);
  }
  // coeff part
  let coeffStr = '';
  if(isOneR(coeff)) coeffStr = 'x';
  else if(coeff.n === -coeff.d) coeffStr = '-x';
  else coeffStr = toStrR(coeff) + 'x';

  if(isZeroR(consta)) return coeffStr;
  // const part
  if(consta.n > 0) return coeffStr + ' + ' + toStrR(consta);
  return coeffStr + ' - ' + toStrR(makeR(Math.abs(consta.n), consta.d));
}

/* Huidige vergelijking: coeff * x + const = right */
let coeff, consta, rightVal;
let oplossing; // integer solution for comparison

function newEquation(){
  const level = document.getElementById('level').value;
  let a, x, b;
  if(level === 'easy'){
    a = Math.floor(Math.random()*5)+1; //1-5
    x = Math.floor(Math.random()*9)+1; //1-9
    b = Math.floor(Math.random()*10); //0-9
  } else if(level === 'medium'){
    a = Math.floor(Math.random()*9)+2; //2-10
    x = Math.floor(Math.random()*21)-10; //-10..10
    b = Math.floor(Math.random()*21)-10; //-10..10
  } else {
    a = Math.floor(Math.random()*9)+2;
    x = Math.floor(Math.random()*21)-10;
    b = Math.floor(Math.random()*21)-10;
  }
  coeff = makeR(a,1);
  consta = makeR(b,1);
  rightVal = makeR(a*x + b,1);
  oplossing = x;
  document.getElementById('stappen').innerHTML = '';
  updateEquationDisplay();
  addStep('Start', formatLeft(coeff,consta) + ' = ' + toStrR(rightVal));
  document.getElementById('feedback').innerText = '';
  document.getElementById('userNumber').value = '';
}

function updateEquationDisplay(){
  document.getElementById('equation').textContent = formatLeft(coeff,consta) + ' = ' + toStrR(rightVal);
}

function addStep(title, text){
  const stappen = document.getElementById('stappen');
  const div = document.createElement('div');
  div.className = 'stapregel';
  div.innerHTML = '<strong>' + title + ':</strong>\n' + text;
  stappen.appendChild(div);
  // scroll to bottom
  stappen.scrollTop = stappen.scrollHeight;
}

function doStep(){
  const operatie = document.getElementById('bewerking').value;
  const numInput = document.getElementById('userNumber').value;
  if(numInput === ''){ document.getElementById('feedback').innerText = 'Vul een getal in.'; return; }
  const n = parseInt(numInput,10);
  if(!Number.isInteger(n)){ document.getElementById('feedback').innerText = 'Voer een geheel getal in.'; return; }

  // bewaar oude waarden
  const coeffBefore = {n: coeff.n, d: coeff.d};
  const constBefore = {n: consta.n, d: consta.d};
  const rightBefore = {n: rightVal.n, d: rightVal.d};

  // pas operatie toe op beide kanten (coeff en const voor links)
  try {
    if(operatie === '+'){
      consta = addR(consta, makeR(n,1));
      rightVal = addR(rightVal, makeR(n,1));
    } else if(operatie === '-'){
      consta = subR(consta, makeR(n,1));
      rightVal = subR(rightVal, makeR(n,1));
    } else if(operatie === '*'){
      coeff = mulR(coeff, makeR(n,1));
      consta = mulR(consta, makeR(n,1));
      rightVal = mulR(rightVal, makeR(n,1));
    } else if(operatie === '/'){
      if(n === 0){ document.getElementById('feedback').innerText = 'Delen door 0 is niet toegestaan.'; return; }
      coeff = divR(coeff, makeR(n,1));
      consta = divR(consta, makeR(n,1));
      rightVal = divR(rightVal, makeR(n,1));
    }
  } catch(e){
    document.getElementById('feedback').innerText = 'Fout bij uitvoeren van de bewerking.';
    return;
  }

  // Bouw staptekst met geëvalueerde resultaten
  const opSym = (operatie === '*') ? '×' : (operatie === '/') ? '÷' : operatie;
  const leftBeforeStr = formatLeft(coeffBefore, constBefore);
  const leftAfterStr = formatLeft(coeff, consta);
  const rightBeforeStr = toStrR(rightBefore);
  const rightAfterStr = toStrR(rightVal);

  const stapText = leftBeforeStr + ' ' + opSym + ' ' + n + ' = ' + leftAfterStr + '\n' +
                   rightBeforeStr + ' ' + opSym + ' ' + n + ' = ' + rightAfterStr;

  addStep('Actie', stapText);
  updateEquationDisplay();
  document.getElementById('userNumber').value = '';
  document.getElementById('feedback').innerText = 'Stap uitgevoerd.';

  // Check of links precies 'x' is (coeff == 1 en const == 0)
  if(isOneR(coeff) && isZeroR(consta)){
    const gevonden = rightVal;
    const juist = eqR(gevonden, makeR(oplossing,1));
    if(juist){
      document.getElementById('feedback').innerText = '✅ Oplossing gevonden: x = ' + toStrR(gevonden) + ' (goed gedaan!)';
      addStep('Eind', 'x = ' + toStrR(gevonden) + ' (correct)');
    } else {
      document.getElementById('feedback').innerText = '❌ Je hebt x = ' + toStrR(gevonden) + ', maar het juiste antwoord is ' + String(oplossing);
      addStep('Eind', 'x = ' + toStrR(gevonden) + ' (fout — correct is ' + String(oplossing) + ')');
    }
  }
}

function reset(){
  newEquation();
}

newEquation();
</script>
</body>
</html>
